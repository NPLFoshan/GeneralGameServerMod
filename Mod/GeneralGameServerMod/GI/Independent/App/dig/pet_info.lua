PetInfoUI = {
  [1] = {
    ["type"] = "ui",
    ["params"] = {
      ["width"] = 400,
      ["y"] = 287,
      ["background_res"] = {hash = "Fk4z2uPQI_S6qcP1MJM3wo-PHdxp", pid = "43477", ext = "png"},
      ["parent"] = "__root",
      ["zorder"] = 13,
      ["align"] = "_lt",
      ["x"] = 800,
      ["type"] = "container",
      ["height"] = 450,
      ["name"] = "info",
      ["events"] = {}
    }
  },
  [2] = {
    ["type"] = "ui",
    ["params"] = {
      ["width"] = 200,
      ["y"] = 20,
      ["x"] = 20,
      ["parent"] = "info",
      ["text"] = "宠物名字",
      ["zorder"] = 3,
      ["height"] = 50,
      ["events"] = {},
      ["font_size"] = 35,
      ["type"] = "text",
      ["font_color"] = "255 255 255",
      ["name"] = "name",
      ["align"] = "_lt"
    }
  },
  [3] = {
    ["type"] = "ui",
    ["params"] = {
      ["width"] = 100,
      ["y"] = 80,
      ["font_color"] = "255 255 255",
      ["parent"] = "info",
      ["text"] = "辅助技能",
      ["zorder"] = 3,
      ["height"] = 30,
      ["events"] = {},
      ["font_size"] = 25,
      ["type"] = "text",
      ["x"] = 20,
      ["name"] = "ability1",
      ["align"] = "_lt"
    }
  },
  [4] = {
    ["type"] = "ui",
    ["params"] = {
      ["width"] = 200,
      ["y"] = 80,
      ["x"] = 150,
      ["parent"] = "info",
      ["text"] = "99999999",
      ["zorder"] = 3,
      ["height"] = 30,
      ["events"] = {},
      ["font_size"] = 25,
      ["type"] = "text",
      ["font_color"] = "255 255 255",
      ["name"] = "ability1_value",
      ["align"] = "_lt"
    }
  },
  [5] = {
    ["type"] = "ui",
    ["params"] = {
      ["width"] = 100,
      ["y"] = 120,
      ["font_color"] = "255 255 255",
      ["parent"] = "info",
      ["text"] = "辅助技能",
      ["zorder"] = 3,
      ["name"] = "ability2",
      ["events"] = {},
      ["font_size"] = 25,
      ["type"] = "text",
      ["x"] = 20,
      ["height"] = 36,
      ["align"] = "_lt"
    }
  },
  [6] = {
    ["type"] = "ui",
    ["params"] = {
      ["x"] = 20,
      ["y"] = 160,
      ["font_color"] = "255 255 255",
      ["parent"] = "info",
      ["text"] = "辅助技能",
      ["zorder"] = 3,
      ["name"] = "ability3",
      ["events"] = {},
      ["font_size"] = 25,
      ["type"] = "text",
      ["width"] = 100,
      ["height"] = 36,
      ["align"] = "_lt"
    }
  },
  [7] = {
    ["type"] = "ui",
    ["params"] = {
      ["width"] = 100,
      ["y"] = 200,
      ["font_color"] = "255 255 255",
      ["parent"] = "info",
      ["text"] = "辅助技能",
      ["zorder"] = 3,
      ["height"] = 36,
      ["events"] = {},
      ["font_size"] = 25,
      ["type"] = "text",
      ["x"] = 20,
      ["name"] = "ability4",
      ["align"] = "_lt"
    }
  },
  [8] = {
    ["type"] = "ui",
    ["params"] = {
      ["width"] = 200,
      ["y"] = 120,
      ["font_color"] = "255 255 255",
      ["parent"] = "info",
      ["text"] = "+5000",
      ["zorder"] = 3,
      ["height"] = 36,
      ["events"] = {},
      ["font_size"] = 25,
      ["type"] = "text",
      ["x"] = 150,
      ["name"] = "ability2_value",
      ["align"] = "_lt"
    }
  },
  [9] = {
    ["type"] = "ui",
    ["params"] = {
      ["width"] = 200,
      ["y"] = 160,
      ["font_color"] = "255 255 255",
      ["parent"] = "info",
      ["text"] = "text",
      ["zorder"] = 3,
      ["height"] = 36,
      ["events"] = {},
      ["font_size"] = 25,
      ["type"] = "text",
      ["x"] = 150,
      ["name"] = "ability3_value",
      ["align"] = "_lt"
    }
  },
  [10] = {
    ["type"] = "ui",
    ["params"] = {
      ["width"] = 200,
      ["y"] = 200,
      ["font_color"] = "255 255 255",
      ["parent"] = "info",
      ["text"] = "*1.15",
      ["zorder"] = 3,
      ["height"] = 36,
      ["events"] = {},
      ["font_size"] = 25,
      ["type"] = "text",
      ["x"] = 150,
      ["name"] = "ability4_value",
      ["align"] = "_lt"
    }
  },
  [11] = {
    ["type"] = "ui",
    ["params"] = {
      ["width"] = 200,
      ["y"] = 20,
      ["x"] = 280,
      ["parent"] = "info",
      ["text"] = "Lv.11",
      ["zorder"] = 3,
      ["height"] = 50,
      ["events"] = {},
      ["font_size"] = 35,
      ["type"] = "text",
      ["font_color"] = "255 255 255",
      ["name"] = "level",
      ["align"] = "_lt"
    }
  },
  [12] = {
    ["type"] = "ui",
    ["params"] = {
      ["width"] = 100,
      ["y"] = 260,
      ["font_color"] = "255 255 255",
      ["parent"] = "info",
      ["text"] = "升级资源",
      ["zorder"] = 3,
      ["height"] = 36,
      ["events"] = {},
      ["font_size"] = 25,
      ["type"] = "text",
      ["x"] = 20,
      ["name"] = "Requirement1",
      ["align"] = "_lt"
    }
  },
  [13] = {
    ["type"] = "ui",
    ["params"] = {
      ["width"] = 100,
      ["y"] = 300,
      ["font_color"] = "255 255 255",
      ["parent"] = "info",
      ["text"] = "升级资源",
      ["zorder"] = 3,
      ["height"] = 36,
      ["events"] = {},
      ["font_size"] = 25,
      ["type"] = "text",
      ["x"] = 20,
      ["name"] = "Requirement2",
      ["align"] = "_lt"
    }
  },
  [14] = {
    ["type"] = "ui",
    ["params"] = {
      ["width"] = 100,
      ["y"] = 340,
      ["font_color"] = "255 255 255",
      ["parent"] = "info",
      ["text"] = "升级资源",
      ["zorder"] = 3,
      ["height"] = 36,
      ["events"] = {},
      ["font_size"] = 25,
      ["type"] = "text",
      ["x"] = 20,
      ["name"] = "Requirement3",
      ["align"] = "_lt"
    }
  },
  [15] = {
    ["type"] = "ui",
    ["params"] = {
      ["width"] = 300,
      ["y"] = 260,
      ["font_color"] = "255 255 255",
      ["parent"] = "info",
      ["text"] = "000001/999999",
      ["zorder"] = 3,
      ["height"] = 36,
      ["events"] = {},
      ["font_size"] = 25,
      ["type"] = "text",
      ["x"] = 150,
      ["name"] = "Requirement1_value",
      ["align"] = "_lt"
    }
  },
  [16] = {
    ["type"] = "ui",
    ["params"] = {
      ["width"] = 300,
      ["y"] = 300,
      ["font_color"] = "255 255 255",
      ["parent"] = "info",
      ["text"] = "666666/999999",
      ["zorder"] = 3,
      ["height"] = 36,
      ["events"] = {},
      ["font_size"] = 25,
      ["type"] = "text",
      ["x"] = 150,
      ["name"] = "Requirement2_value",
      ["align"] = "_lt"
    }
  },
  [17] = {
    ["type"] = "ui",
    ["params"] = {
      ["width"] = 300,
      ["y"] = 340,
      ["font_color"] = "255 255 255",
      ["parent"] = "info",
      ["text"] = "999999/999999",
      ["zorder"] = 3,
      ["height"] = 36,
      ["events"] = {},
      ["font_size"] = 25,
      ["type"] = "text",
      ["x"] = 150,
      ["name"] = "Requirement3_value",
      ["align"] = "_lt"
    }
  },
  [18] = {
    ["type"] = "ui",
    ["params"] = {
      ["width"] = 133,
      ["y"] = 382,
      ["background_res"] = {hash = "FhvKsrqxx32XopelFdMpt3_8mS6I", pid = "43501", ext = "png"},
      ["parent"] = "info",
      ["zorder"] = 3,
      ["align"] = "_lt",
      ["type"] = "button",
      ["x"] = 50,
      ["height"] = 58,
      ["name"] = "nickname",
      ["onclick"] = function()
        NickNameUI.show(PetInfoUI.mItem)
      end
    }
  },
  [19] = {
    ["type"] = "ui",
    ["params"] = {
      ["width"] = 133,
      ["y"] = 382,
      ["background_res"] = {hash = "FtFq7Cxh7NP2JrWjJX2zUPdWFwJ7", pid = "257", ext = "png"},
      ["parent"] = "info",
      ["text"] = "",
      ["zorder"] = 3,
      ["align"] = "_lt",
      ["type"] = "button",
      ["x"] = 210,
      ["height"] = 58,
      ["name"] = "OK",
      ["onclick"] = function()
        PetInfoUI.close()
      end
    }
  }
}

local function clone(from)
  local ret
  if type(from) == "table" then
    ret = {}
    for key, value in pairs(from) do
      ret[key] = clone(value)
    end
  else
    ret = from
  end
  return ret
end

function PetInfoUI.show(item)
  PetInfoUI.close()
  PetInfoUI.mItem = item
  PetInfoUI.mUIs = {}
  for _, cfg in ipairs(PetInfoUI) do
    local cfg_cpy = clone(cfg)
    cfg_cpy.params.name = "PetInfoUI/" .. cfg_cpy.params.name
    cfg_cpy.params.parent = PetInfoUI.mUIs[cfg.params.parent]
    cfg_cpy.params.align = cfg.params.align or "_lt"
    local ui = CreateUI(cfg_cpy.params)
    PetInfoUI.mUIs[cfg.params.name] = ui
    if cfg.params.background_res then
      GetResourceImage(
        cfg.params.background_res,
        function(path, err)
          ui.background = path
        end
      )
    else
      ui.background = ""
    end
  end
  PetInfoUI.mUIs["name"].text = item.mName or Config.Avatar.Pet[item.mConfigIndex].mDefaceName
  PetInfoUI.mUIs["level"].text = "Lv." .. tostring(item.mLevel)
  for i = 1, 4 do
    PetInfoUI.mUIs["ability" .. tostring(i)].visible = false
    PetInfoUI.mUIs["ability" .. tostring(i) .. "_value"].visible = false
  end
  local buffs = GlobalFunction.parsePetRGB(item.mRGB)
  local additions = GlobalFunction.getPetLevelAddition(item.mLevel)
  local index = 1
  for k, v in pairs(buffs) do
    PetInfoUI.mUIs["ability" .. tostring(index)].visible = true
    PetInfoUI.mUIs["ability" .. tostring(index)].text = k
    PetInfoUI.mUIs["ability" .. tostring(index) .. "_value"].visible = true
    PetInfoUI.mUIs["ability" .. tostring(index) .. "_value"].text = tostring(additions[k][v])
    index = index + 1
  end
  if item.mLevel < 10 then
    for i=1,3 do
      PetInfoUI.mUIs["Requirement"..tostring(i)].text = GlobalFunction.getMiningBlock(Config.Avatar.Pet[item.mConfigIndex].mLevelUp[item.mLevel + 1][i].mBlockID).name
      PetInfoUI.mUIs["Requirement"..tostring(i).."_value"].text = (item.mExp[i] or 0).."/"..tostring(Config.Avatar.Pet[item.mConfigIndex].mLevelUp[item.mLevel + 1][i].mCount)
    end
  else
    for i=1,3 do
      PetInfoUI.mUIs["Requirement"..tostring(i)].visible = false
      PetInfoUI.mUIs["Requirement"..tostring(i).."_value"].text = "满级"
    end
  end
end

function PetInfoUI.close()
  if PetInfoUI.mUIs then
    PetInfoUI.mItem = nil
    PetInfoUI.mUIs[PetInfoUI[1].params.name]:destroy()
    PetInfoUI.mUIs = nil
  end
end
