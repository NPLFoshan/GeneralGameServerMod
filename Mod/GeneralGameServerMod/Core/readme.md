
# Core

GGS 模块核心实现, 主要完成联机世界的基本功能.

- 同步玩家实体信息, 即人物信息
- 同步玩家基本虚拟信息, 如玩家在线状态, 用户名等, 玩家信息里面有个 userinfo 用户信息, 可用于简单的业务用户信息同步.

Core 只维护实时数据, 需要做持久的数据业务放在 App 应用层实现.

## 无保存模式世界环境信息同步

在编辑模式, 用户可以随意的修改世界, 后进入世界的玩家如何获取之前的修改, 解决方案有两种:

1. 服务器维护世界修改,  会导致服务器内存占用过大, 从而支持的世界数减少
2. 由最早进入的玩家提供世界变更消息, 后进入玩家找该玩家同步世界信息,  若后同步的玩家过多, 需要从已完成同步的玩家中选择基准点(玩家负载均衡)

## 角色房间细化

## 服务器统计信息获取

[x] 方块同步
[x] 命令同步  需要注意递归  增加跳板避免递归触发命令

- 服务器信息统计

## 世界同步

世界同步大致分为角色同步, 方块同步, 命令同步, 事件同步四类数据的同步,

### 角色同步

角色同步主要同步玩家的相关属性信息即可

### 方块同步

对于普通常规方块(不触发事件, 方块状态不会变化)直接基本信息即可, 但有两类方块处理较为麻烦, 一类是代码,电影类含有大量数据和实体信息方块, 此类方块一般有相应的编辑器, 会触发编辑事件,

通过监听编辑事件去同步此类方块的数据信息(创建时需同步全部信息), 另一类是机关方块, 用户触发机关方块可能其他方块状态发生相应的变化, 这些变化若全部同步导致网络消耗极大且难以控制, 所以此类方块位置和ID同步,

其方块数据不做同步. 若需同步借助事件同步(模拟相应的事件触发)实现.

### 命令同步

命令同步比较简单, 直接转发命令即可.

### 事件同步

事件同步较为麻烦, 如直接在事件发生处模拟转发还比较简单, 这种会与前面同步有一定冲突, 而且体验极差, 更多场景是事件不需要同步, 只有在需要的情况才去同步, 所以需要用户主动去同步事件.

如何主动同步事件(如按钮按下点击事件, 含羞草踩下的碰撞事件等机关方块状态变化)? 这些事件发生都是能量的波动变化, 而命令方块可以检测这种能量变化并触发命令的执行, 因此通过带有同步命令的

命令方块去检测事件并模拟事件的发生即可. 但这种方式也有弊端需要避免造成死环(世界A事件a=>同步事件a命令=>世界B事件a=>同步事件a命令=>世界A事件a=>...), 当然不是所有事件命令都会触发事件

再次执行, 如: tip, loadworld 等.  只有模拟事件发生的命令会触发循环, 如按下按钮, 执行activate命令去模拟按钮按下. 当发生此类场景需引入中间拉取方块, 事件触发命令, 命令激活中间方块完成最终

效果, 这样可以避免死环.

拉杆同步

### 配置机关方块白名单

放置一个代码方块,进入世界自执行. 配置ggs同步信息.

TODO:

- 学校名字加<> vip logo 切换
- 链接成功提示屏蔽